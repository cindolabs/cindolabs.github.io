<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Hocindo Equity Growth Map - Interactive dashboard for equity growth analysis">
    <title>Hocindo Equity Growth Map</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.tailwindcss.min.css">
    <!-- AOS CSS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            @apply bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100;
        }
        .dataTable-container {
            @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8;
        }
        .chart-container {
            @apply max-w-4xl mx-auto mt-8 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg;
        }
        .filter-container {
            @apply flex flex-col sm:flex-row gap-4 mb-6;
        }
        .export-btn {
            @apply inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition;
        }
        .mode-toggle {
            @apply fixed top-4 right-4 p-2 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 transition;
        }
    </style>
</head>
<body>
    <!-- Mode Toggle -->
    <button id="modeToggle" class="mode-toggle" aria-label="Toggle dark mode">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Header -->
    <header class="py-6 text-center" data-aos="fade-down">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white">Hocindo Equity Growth Map</h1>
        <p class="mt-2 text-lg text-gray-600 dark:text-gray-300">Interactive dashboard for equity growth analysis</p>
    </header>

    <!-- Filter and Export -->
    <div class="filter-container" data-aos="fade-up">
        <input type="text" id="searchInput" placeholder="Cari di tabel..." class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
        <select id="levelFilter" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
            <option value="">Semua Level</option>
        </select>
        <button id="exportCsv" class="export-btn"><i class="fas fa-download mr-2"></i> Export CSV</button>
        <button id="exportJson" class="export-btn"><i class="fas fa-download mr-2"></i> Export JSON</button>
        <select id="languageSelect" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
            <option value="id">Bahasa Indonesia</option>
            <option value="en">English</option>
        </select>
    </div>

    <!-- Table -->
    <div class="dataTable-container" data-aos="fade-up">
        <table id="equityTable" class="w-full">
            <thead>
                <tr>
                    <th>Level</th>
                    <th>Saldo</th>
                    <th>Volume</th>
                    <th>Laba / Rugi</th>
                    <th>Equitas Laba</th>
                    <th>Equitas Rugi</th>
                    <th>Piper</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data akan dimuat melalui JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Chart -->
    <div class="chart-container" data-aos="fade-up">
        <canvas id="equityChart"></canvas>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.tailwindcss.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/i18next@23.10.1/dist/umd/i18next.min.js"></script>
    <script>
        // Inisialisasi AOS
        AOS.init();

        // Data awal (bisa diganti dengan data dari API)
        const initialData = [
            { level: 1, saldo: 10.00, volume: 0.01, labaRugi: 1.00, equitasLaba: 11.00, equitasRugi: 9.00, piper: 100 },
            { level: 2, saldo: 11.00, volume: 0.01, labaRugi: 1.10, equitasLaba: 12.10, equitasRugi: 9.10, piper: 110 },
            // Tambahkan data lainnya seperti di HTML asli
            { level: 50, saldo: 1064.74, volume: 0.55, labaRugi: 106.47, equitasLaba: 1171.21, equitasRugi: 958.27, piper: 194 }
        ];

        // Inisialisasi i18next untuk multibahasa
        i18next.init({
            lng: 'id',
            resources: {
                id: {
                    translation: {
                        "title": "Hocindo Equity Growth Map",
                        "description": "Dasbor interaktif untuk analisis pertumbuhan ekuitas",
                        "level": "Level",
                        "saldo": "Saldo",
                        "volume": "Volume",
                        "labaRugi": "Laba / Rugi",
                        "equitasLaba": "Equitas Laba",
                        "equitasRugi": "Equitas Rugi",
                        "piper": "Piper",
                        "searchPlaceholder": "Cari di tabel...",
                        "allLevels": "Semua Level",
                        "exportCsv": "Export CSV",
                        "exportJson": "Export JSON"
                    }
                },
                en: {
                    translation: {
                        "title": "Hocindo Equity Growth Map",
                        "description": "Interactive dashboard for equity growth analysis",
                        "level": "Level",
                        "saldo": "Balance",
                        "volume": "Volume",
                        "labaRugi": "Profit / Loss",
                        "equitasLaba": "Profit Equity",
                        "equitasRugi": "Loss Equity",
                        "piper": "Piper",
                        "searchPlaceholder": "Search in table...",
                        "allLevels": "All Levels",
                        "exportCsv": "Export CSV",
                        "exportJson": "Export JSON"
                    }
                }
            }
        }, function(err, t) {
            updateTranslations();
        });

        // Fungsi untuk update terjemahan
        function updateTranslations() {
            document.querySelector('h1').textContent = i18next.t('title');
            document.querySelector('header p').textContent = i18next.t('description');
            document.getElementById('searchInput').placeholder = i18next.t('searchPlaceholder');
            document.getElementById('levelFilter').options[0].text = i18next.t('allLevels');
            document.getElementById('exportCsv').innerHTML = `<i class="fas fa-download mr-2"></i> ${i18next.t('exportCsv')}`;
            document.getElementById('exportJson').innerHTML = `<i class="fas fa-download mr-2"></i> ${i18next.t('exportJson')}`;
            const headers = document.querySelectorAll('#equityTable thead th');
            headers[0].textContent = i18next.t('level');
            headers[1].textContent = i18next.t('saldo');
            headers[2].textContent = i18next.t('volume');
            headers[3].textContent = i18next.t('labaRugi');
            headers[4].textContent = i18next.t('equitasLaba');
            headers[5].textContent = i18next.t('equitasRugi');
            headers[6].textContent = i18next.t('piper');
        }

        // Inisialisasi DataTable
        const table = $('#equityTable').DataTable({
            data: initialData,
            columns: [
                { data: 'level' },
                { data: 'saldo', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
                { data: 'volume', render: $.fn.dataTable.render.number(',', '.', 2) },
                { data: 'labaRugi', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
                { data: 'equitasLaba', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
                { data: 'equitasRugi', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
                { data: 'piper' }
            ],
            pageLength: 10,
            responsive: true,
            language: {
                search: '',
                searchPlaceholder: i18next.t('searchPlaceholder')
            }
        });

        // Load data dari GitHub (opsional)
        async function loadDataFromGithub() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/hocindo/hocindo.github.io/main/financial_dashboard/equity_data.json');
                const data = await response.json();
                table.clear().rows.add(data).draw();
            } catch (error) {
                console.error('Error loading data from GitHub:', error);
            }
        }

        // Filter level
        const levelFilter = document.getElementById('levelFilter');
        initialData.forEach(row => {
            const option = document.createElement('option');
            option.value = row.level;
            option.text = `Level ${row.level}`;
            levelFilter.appendChild(option);
        });

        levelFilter.addEventListener('change', function() {
            const value = this.value;
            table.column(0).search(value ? `^${value}$` : '', true, false).draw();
        });

        // Search input
        document.getElementById('searchInput').addEventListener('input', function() {
            table.search(this.value).draw();
        });

        // Export CSV
        document.getElementById('exportCsv').addEventListener('click', function() {
            const data = table.data().toArray();
            const csv = Papa.unparse(data);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'hocindo_equity_map.csv';
            link.click();
        });

        // Export JSON
        document.getElementById('exportJson').addEventListener('click', function() {
            const data = table.data().toArray();
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'hocindo_equity_map.json';
            link.click();
        });

        // Dark mode toggle
        document.getElementById('modeToggle').addEventListener('click', function() {
            document.documentElement.classList.toggle('dark');
            this.innerHTML = document.documentElement.classList.contains('dark') 
                ? '<i class="fas fa-sun"></i>' 
                : '<i class="fas fa-moon"></i>';
        });

        // Inisialisasi Chart.js
        const ctx = document.getElementById('equityChart').getContext('2d');
        const equityChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: initialData.map(row => `Level ${row.level}`),
                datasets: [
                    {
                        label: 'Saldo',
                        data: initialData.map(row => row.saldo),
                        borderColor: '#4CAF50',
                        fill: false
                    },
                    {
                        label: 'Equitas Laba',
                        data: initialData.map(row => row.equitasLaba),
                        borderColor: '#2563eb',
                        fill: false
                    },
                    {
                        label: 'Equitas Rugi',
                        data: initialData.map(row => row.equitasRugi),
                        borderColor: '#dc2626',
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'Equity Growth Trend' }
                },
                scales: {
                    y: { beginAtZero: false, title: { display: true, text: 'Value ($)' } },
                    x: { title: { display: true, text: 'Level' } }
                }
            }
        });

        // Update chart saat tabel di-filter
        table.on('draw', function() {
            const filteredData = table.rows({ filter: 'applied' }).data().toArray();
            equityChart.data.labels = filteredData.map(row => `Level ${row.level}`);
            equityChart.data.datasets[0].data = filteredData.map(row => row.saldo);
            equityChart.data.datasets[1].data = filteredData.map(row => row.equitasLaba);
            equityChart.data.datasets[2].data = filteredData.map(row => row.equitasRugi);
            equityChart.update();
        });

        // Ganti bahasa
        document.getElementById('languageSelect').addEventListener('change', function() {
            i18next.changeLanguage(this.value, function(err, t) {
                updateTranslations();
                table.draw();
            });
        });

        // Load data dari GitHub saat halaman dimuat
        loadDataFromGithub();
    </script>
    <!-- PapaParse for CSV export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</body>
</html>
