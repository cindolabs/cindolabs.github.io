<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Hocindo Equity Growth Map - Interactive dashboard for equity growth analysis">
    <title>Hocindo Equity Growth Map</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.tailwindcss.min.css">
    <!-- AOS CSS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            @apply bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100;
        }
        .dataTable-container {
            @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8;
        }
        .chart-container {
            @apply max-w-4xl mx-auto mt-8 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg;
        }
        .filter-container {
            @apply flex flex-col sm:flex-row gap-4 mb-6;
        }
        .export-btn {
            @apply inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition;
        }
        .mode-toggle {
            @apply fixed top-4 right-4 p-2 bg-gray-200 dark:bg-gray-700 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 transition;
        }
    </style>
</head>
<body>
    <!-- Mode Toggle -->
    <button id="modeToggle" class="mode-toggle" aria-label="Toggle dark mode">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Header -->
    <header class="py-6 text-center" data-aos="fade-down">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white">Hocindo Equity Growth Map</h1>
        <p class="mt-2 text-lg text-gray-600 dark:text-gray-300">Interactive dashboard for equity growth analysis</p>
    </header>

    <!-- Filter and Export -->
    <div class="filter-container" data-aos="fade-up">
        <input type="text" id="searchInput" placeholder="Cari di tabel..." class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
        <select id="levelFilter" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
            <option value="">Semua Level</option>
        </select>
        <button id="exportCsv" class="export-btn"><i class="fas fa-download mr-2"></i> Export CSV</button>
        <button id="exportJson" class="export-btn"><i class="fas fa-download mr-2"></i> Export JSON</button>
        <select id="languageSelect" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
            <option value="id">Bahasa Indonesia</option>
            <option value="en">English</option>
        </select>
    </div>

    <!-- Table -->
    <div class="dataTable-container" data-aos="fade-up">
        <table id="equityTable" class="w-full">
            <thead>
                <tr>
                    <th>Level</th>
                    <th>Saldo</th>
                    <th>Volume</th>
                    <th>Laba / Rugi</th>
                    <th>Equitas Laba</th>
                    <th>Equitas Rugi</th>
                    <th>Pips</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data akan dimuat melalui JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Chart -->
    <div class="chart-container" data-aos="fade-up">
        <canvas id="equityChart"></canvas>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.tailwindcss.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/i18next@23.10.1/dist/umd/i18next.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        // Inisialisasi AOS
        AOS.init();

        // Data lengkap untuk 100 level
        const initialData = [
            { level: 1, saldo: 10.00, volume: 0.01, labaRugi: 1.00, equitasLaba: 11.00, equitasRugi: 9.00, piper: 100 },
            { level: 2, saldo: 11.00, volume: 0.01, labaRugi: 1.52, equitasLaba: 12.52, equitasRugi: 9.48, piper: 152 },
            { level: 3, saldo: 12.52, volume: 0.01, labaRugi: 1.53, equitasLaba: 14.05, equitasRugi: 10.99, piper: 153 },
            { level: 4, saldo: 14.05, volume: 0.01, labaRugi: 1.55, equitasLaba: 15.60, equitasRugi: 12.50, piper: 155 },
            { level: 5, saldo: 15.60, volume: 0.01, labaRugi: 1.56, equitasLaba: 17.16, equitasRugi: 14.04, piper: 156 },
            { level: 6, saldo: 17.16, volume: 0.01, labaRugi: 1.58, equitasLaba: 18.74, equitasRugi: 15.58, piper: 158 },
            { level: 7, saldo: 18.74, volume: 0.01, labaRugi: 1.60, equitasLaba: 20.34, equitasRugi: 17.14, piper: 160 },
            { level: 8, saldo: 20.34, volume: 0.02, labaRugi: 3.24, equitasLaba: 23.58, equitasRugi: 17.10, piper: 162 },
            { level: 9, saldo: 23.58, volume: 0.02, labaRugi: 3.28, equitasLaba: 26.86, equitasRugi: 20.30, piper: 164 },
            { level: 10, saldo: 26.86, volume: 0.02, labaRugi: 3.32, equitasLaba: 30.18, equitasRugi: 23.54, piper: 166 },
            { level: 11, saldo: 30.18, volume: 0.02, labaRugi: 3.36, equitasLaba: 33.54, equitasRugi: 26.82, piper: 168 },
            { level: 12, saldo: 33.54, volume: 0.02, labaRugi: 3.41, equitasLaba: 36.95, equitasRugi: 30.13, piper: 170 },
            { level: 13, saldo: 36.95, volume: 0.02, labaRugi: 3.45, equitasLaba: 40.40, equitasRugi: 33.50, piper: 172 },
            { level: 14, saldo: 40.40, volume: 0.02, labaRugi: 3.49, equitasLaba: 43.89, equitasRugi: 36.91, piper: 174 },
            { level: 15, saldo: 43.89, volume: 0.02, labaRugi: 3.54, equitasLaba: 47.43, equitasRugi: 40.35, piper: 177 },
            { level: 16, saldo: 47.43, volume: 0.02, labaRugi: 3.58, equitasLaba: 51.01, equitasRugi: 43.85, piper: 179 },
            { level: 17, saldo: 51.01, volume: 0.03, labaRugi: 5.43, equitasLaba: 56.44, equitasRugi: 45.58, piper: 181 },
            { level: 18, saldo: 56.44, volume: 0.03, labaRugi: 5.49, equitasLaba: 61.93, equitasRugi: 50.95, piper: 183 },
            { level: 19, saldo: 61.93, volume: 0.03, labaRugi: 5.55, equitasLaba: 67.48, equitasRugi: 56.38, piper: 185 },
            { level: 20, saldo: 67.48, volume: 0.03, labaRugi: 5.61, equitasLaba: 73.09, equitasRugi: 61.87, piper: 187 },
            { level: 21, saldo: 73.09, volume: 0.03, labaRugi: 5.67, equitasLaba: 78.76, equitasRugi: 67.42, piper: 189 },
            { level: 22, saldo: 78.76, volume: 0.03, labaRugi: 5.73, equitasLaba: 84.49, equitasRugi: 73.03, piper: 191 },
            { level: 23, saldo: 84.49, volume: 0.03, labaRugi: 5.79, equitasLaba: 90.28, equitasRugi: 78.70, piper: 193 },
            { level: 24, saldo: 90.28, volume: 0.03, labaRugi: 5.86, equitasLaba: 96.14, equitasRugi: 84.42, piper: 195 },
            { level: 25, saldo: 96.14, volume: 0.03, labaRugi: 5.92, equitasLaba: 102.06, equitasRugi: 90.22, piper: 197 },
            { level: 26, saldo: 102.06, volume: 0.04, labaRugi: 7.99, equitasLaba: 110.05, equitasRugi: 94.07, piper: 200 },
            { level: 27, saldo: 110.05, volume: 0.04, labaRugi: 8.08, equitasLaba: 118.13, equitasRugi: 101.97, piper: 202 },
            { level: 28, saldo: 118.13, volume: 0.04, labaRugi: 8.17, equitasLaba: 126.30, equitasRugi: 109.96, piper: 204 },
            { level: 29, saldo: 126.30, volume: 0.04, labaRugi: 8.26, equitasLaba: 134.56, equitasRugi: 118.04, piper: 206 },
            { level: 30, saldo: 134.56, volume: 0.04, labaRugi: 8.35, equitasLaba: 142.91, equitasRugi: 126.21, piper: 209 },
            { level: 31, saldo: 142.91, volume: 0.04, labaRugi: 8.44, equitasLaba: 151.35, equitasRugi: 134.47, piper: 211 },
            { level: 32, saldo: 151.35, volume: 0.04, labaRugi: 8.54, equitasLaba: 159.89, equitasRugi: 142.81, piper: 213 },
            { level: 33, saldo: 159.89, volume: 0.04, labaRugi: 8.63, equitasLaba: 168.52, equitasRugi: 151.26, piper: 216 },
            { level: 34, saldo: 168.52, volume: 0.04, labaRugi: 8.73, equitasLaba: 177.25, equitasRugi: 159.79, piper: 218 },
            { level: 35, saldo: 177.25, volume: 0.04, labaRugi: 8.82, equitasLaba: 186.07, equitasRugi: 168.43, piper: 220 },
            { level: 36, saldo: 186.07, volume: 0.05, labaRugi: 11.14, equitasLaba: 197.21, equitasRugi: 174.93, piper: 223 },
            { level: 37, saldo: 197.21, volume: 0.05, labaRugi: 11.25, equitasLaba: 208.46, equitasRugi: 185.96, piper: 225 },
            { level: 38, saldo: 208.46, volume: 0.05, labaRugi: 11.36, equitasLaba: 219.82, equitasRugi: 197.10, piper: 227 },
            { level: 39, saldo: 219.82, volume: 0.05, labaRugi: 11.48, equitasLaba: 231.30, equitasRugi: 208.34, piper: 230 },
            { level: 40, saldo: 231.30, volume: 0.05, labaRugi: 11.59, equitasLaba: 242.89, equitasRugi: 219.71, piper: 232 },
            { level: 41, saldo: 242.89, volume: 0.05, labaRugi: 11.71, equitasLaba: 254.60, equitasRugi: 231.18, piper: 234 },
            { level: 42, saldo: 254.60, volume: 0.05, labaRugi: 11.83, equitasLaba: 266.43, equitasRugi: 242.77, piper: 237 },
            { level: 43, saldo: 266.43, volume: 0.05, labaRugi: 11.95, equitasLaba: 278.38, equitasRugi: 254.48, piper: 239 },
            { level: 44, saldo: 278.38, volume: 0.05, labaRugi: 12.07, equitasLaba: 290.45, equitasRugi: 266.31, piper: 241 },
            { level: 45, saldo: 290.45, volume: 0.05, labaRugi: 12.20, equitasLaba: 302.65, equitasRugi: 278.25, piper: 244 },
            { level: 46, saldo: 302.65, volume: 0.06, labaRugi: 14.76, equitasLaba: 317.41, equitasRugi: 287.89, piper: 246 },
            { level: 47, saldo: 317.41, volume: 0.06, labaRugi: 14.90, equitasLaba: 332.31, equitasRugi: 302.51, piper: 248 },
            { level: 48, saldo: 332.31, volume: 0.06, labaRugi: 15.05, equitasLaba: 347.36, equitasRugi: 317.26, piper: 251 },
            { level: 49, saldo: 347.36, volume: 0.06, labaRugi: 15.20, equitasLaba: 362.56, equitasRugi: 332.16, piper: 253 },
            { level: 50, saldo: 362.56, volume: 0.06, labaRugi: 15.35, equitasLaba: 377.91, equitasRugi: 347.21, piper: 256 },
            { level: 51, saldo: 377.91, volume: 0.06, labaRugi: 15.50, equitasLaba: 393.41, equitasRugi: 362.41, piper: 258 },
            { level: 52, saldo: 393.41, volume: 0.06, labaRugi: 15.65, equitasLaba: 409.06, equitasRugi: 377.76, piper: 261 },
            { level: 53, saldo: 409.06, volume: 0.06, labaRugi: 15.81, equitasLaba: 424.87, equitasRugi: 393.25, piper: 263 },
            { level: 54, saldo: 424.87, volume: 0.06, labaRugi: 15.97, equitasLaba: 440.84, equitasRugi: 408.90, piper: 266 },
            { level: 55, saldo: 440.84, volume: 0.06, labaRugi: 16.13, equitasLaba: 456.97, equitasRugi: 424.71, piper: 269 },
            { level: 56, saldo: 456.97, volume: 0.07, labaRugi: 18.83, equitasLaba: 475.80, equitasRugi: 438.14, piper: 269 },
            { level: 57, saldo: 475.80, volume: 0.07, labaRugi: 19.01, equitasLaba: 494.81, equitasRugi: 456.79, piper: 272 },
            { level: 58, saldo: 494.81, volume: 0.07, labaRugi: 19.19, equitasLaba: 514.00, equitasRugi: 475.62, piper: 274 },
            { level: 59, saldo: 514.00, volume: 0.07, labaRugi: 19.38, equitasLaba: 533.38, equitasRugi: 494.62, piper: 277 },
            { level: 60, saldo: 533.38, volume: 0.07, labaRugi: 19.57, equitasLaba: 552.95, equitasRugi: 513.81, piper: 280 },
            { level: 61, saldo: 552.95, volume: 0.07, labaRugi: 19.76, equitasLaba: 572.71, equitasRugi: 533.19, piper: 282 },
            { level: 62, saldo: 572.71, volume: 0.07, labaRugi: 19.95, equitasLaba: 592.66, equitasRugi: 552.76, piper: 285 },
            { level: 63, saldo: 592.66, volume: 0.07, labaRugi: 20.15, equitasLaba: 612.81, equitasRugi: 572.51, piper: 288 },
            { level: 64, saldo: 612.81, volume: 0.07, labaRugi: 20.35, equitasLaba: 633.16, equitasRugi: 592.46, piper: 291 },
            { level: 65, saldo: 633.16, volume: 0.07, labaRugi: 20.55, equitasLaba: 653.71, equitasRugi: 612.61, piper: 294 },
            { level: 66, saldo: 653.71, volume: 0.08, labaRugi: 23.59, equitasLaba: 677.30, equitasRugi: 630.12, piper: 295 },
            { level: 67, saldo: 677.30, volume: 0.08, labaRugi: 23.80, equitasLaba: 701.10, equitasRugi: 653.50, piper: 297 },
            { level: 68, saldo: 701.10, volume: 0.08, labaRugi: 24.01, equitasLaba: 725.11, equitasRugi: 677.09, piper: 300 },
            { level: 69, saldo: 725.11, volume: 0.08, labaRugi: 24.01, equitasLaba: 749.12, equitasRugi: 701.10, piper: 300 },
            { level: 70, saldo: 749.12, volume: 0.08, labaRugi: 24.01, equitasLaba: 773.13, equitasRugi: 725.11, piper: 300 },
            { level: 71, saldo: 773.13, volume: 0.08, labaRugi: 24.01, equitasLaba: 797.14, equitasRugi: 749.12, piper: 300 },
            { level: 72, saldo: 797.14, volume: 0.08, labaRugi: 24.01, equitasLaba: 821.15, equitasRugi: 773.13, piper: 300 },
            { level: 73, saldo: 821.15, volume: 0.08, labaRugi: 24.01, equitasLaba: 845.16, equitasRugi: 797.14, piper: 300 },
            { level: 74, saldo: 845.16, volume: 0.08, labaRugi: 24.01, equitasLaba: 869.17, equitasRugi: 821.15, piper: 300 },
            { level: 75, saldo: 869.17, volume: 0.08, labaRugi: 24.01, equitasLaba: 893.18, equitasRugi: 845.16, piper: 300 },
            { level: 76, saldo: 893.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 920.18, equitasRugi: 866.18, piper: 300 },
            { level: 77, saldo: 920.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 947.18, equitasRugi: 893.18, piper: 300 },
            { level: 78, saldo: 947.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 974.18, equitasRugi: 920.18, piper: 300 },
            { level: 79, saldo: 974.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 1001.18, equitasRugi: 947.18, piper: 300 },
            { level: 80, saldo: 1001.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 1028.18, equitasRugi: 974.18, piper: 300 },
            { level: 81, saldo: 1028.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 1055.18, equitasRugi: 1001.18, piper: 300 },
            { level: 82, saldo: 1055.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 1082.18, equitasRugi: 1055.18, piper: 300 },
            { level: 83, saldo: 1082.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 1109.18, equitasRugi: 1082.18, piper: 300 },
            { level: 84, saldo: 1109.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 1136.18, equitasRugi: 1082.18, piper: 300 },
            { level: 85, saldo: 1136.18, volume: 0.09, labaRugi: 27.00, equitasLaba: 1163.18, equitasRugi: 1109.18, piper: 300 },
            { level: 86, saldo: 1163.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1193.18, equitasRugi: 1133.18, piper: 300 },
            { level: 87, saldo: 1193.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1223.18, equitasRugi: 1163.18, piper: 300 },
            { level: 88, saldo: 1223.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1253.18, equitasRugi: 1193.18, piper: 300 },
            { level: 89, saldo: 1253.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1283.18, equitasRugi: 1223.18, piper: 300 },
            { level: 90, saldo: 1283.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1313.18, equitasRugi: 1253.18, piper: 300 },
            { level: 91, saldo: 1313.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1343.18, equitasRugi: 1283.18, piper: 300 },
            { level: 92, saldo: 1343.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1373.18, equitasRugi: 1343.18, piper: 300 },
            { level: 93, saldo: 1373.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1403.18, equitasRugi: 1373.18, piper: 300 },
            { level: 94, saldo: 1403.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1433.18, equitasRugi: 1373.18, piper: 300 },
            { level: 95, saldo: 1433.18, volume: 0.10, labaRugi: 30.00, equitasLaba: 1463.18, equitasRugi: 1433.18, piper: 300 },
            { level: 96, saldo: 1463.18, volume: 0.11, labaRugi: 33.00, equitasLaba: 1496.18, equitasRugi: 1430.18, piper: 300 },
            { level: 97, saldo: 1496.18, volume: 0.11, labaRugi: 33.00, equitasLaba: 1529.18, equitasRugi: 1463.18, piper: 300 },
            { level: 98, saldo: 1529.18, volume: 0.11, labaRugi: 33.00, equitasLaba: 1562.18, equitasRugi: 1496.18, piper: 300 },
            { level: 99, saldo: 1562.18, volume: 0.11, labaRugi: 33.00, equitasLaba: 1595.18, equitasRugi: 1529.18, piper: 300 },
            { level: 100, saldo: 1595.18, volume: 0.11, labaRugi: 33.00, equitasLaba: 1628.18, equitasRugi: 1562.18, piper: 300 }
        ];

        // Inisialisasi i18next untuk multibahasa
        i18next.init({
            lng: 'id',
            resources: {
                id: {
                    translation: {
                        "title": "Hocindo Equity Growth Map",
                        "description": "Dasbor interaktif untuk analisis pertumbuhan ekuitas",
                        "level": "Level",
                        "saldo": "Saldo",
                        "volume": "Volume",
                        "labaRugi": "Laba / Rugi",
                        "equitasLaba": "Equitas Laba",
                        "equitasRugi": "Equitas Rugi",
                        "piper": "Pips",
                        "searchPlaceholder": "Cari di tabel...",
                        "allLevels": "Semua Level",
                        "exportCsv": "Export CSV",
                        "exportJson": "Export JSON"
                    }
                },
                en: {
                    translation: {
                        "title": "Hocindo Equity Growth Map",
                        "description": "Interactive dashboard for equity growth analysis",
                        "level": "Level",
                        "saldo": "Balance",
                        "volume": "Volume",
                        "labaRugi": "Profit / Loss",
                        "equitasLaba": "Profit Equity",
                        "equitasRugi": "Loss Equity",
                        "piper": "Pips",
                        "searchPlaceholder": "Search in table...",
                        "allLevels": "All Levels",
                        "exportCsv": "Export CSV",
                        "exportJson": "Export JSON"
                    }
                }
            }
        }, function(err, t) {
            updateTranslations();
        });

        // Fungsi untuk update terjemahan
        function updateTranslations() {
            document.querySelector('h1').textContent = i18next.t('title');
            document.querySelector('header p').textContent = i18next.t('description');
            document.getElementById('searchInput').placeholder = i18next.t('searchPlaceholder');
            document.getElementById('levelFilter').options[0].text = i18next.t('allLevels');
            document.getElementById('exportCsv').innerHTML = `<i class="fas fa-download mr-2"></i> ${i18next.t('exportCsv')}`;
            document.getElementById('exportJson').innerHTML = `<i class="fas fa-download mr-2"></i> ${i18next.t('exportJson')}`;
            const headers = document.querySelectorAll('#equityTable thead th');
            headers[0].textContent = i18next.t('level');
            headers[1].textContent = i18next.t('saldo');
            headers[2].textContent = i18next.t('volume');
            headers[3].textContent = i18next.t('labaRugi');
            headers[4].textContent = i18next.t('equitasLaba');
            headers[5].textContent = i18next.t('equitasRugi');
            headers[6].textContent = i18next.t('piper');
        }

        // Inisialisasi DataTable
        const table = $('#equityTable').DataTable({
            data: initialData,
            columns: [
                { data: 'level' },
                { data: 'saldo', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
                { data: 'volume', render: $.fn.dataTable.render.number(',', '.', 2) },
                { data: 'labaRugi', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
                { data: 'equitasLaba', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
                { data: 'equitasRugi', render: $.fn.dataTable.render.number(',', '.', 2, '$') },
                { data: 'piper' }
            ],
            pageLength: 10,
            responsive: true,
            language: {
                search: '',
                searchPlaceholder: i18next.t('searchPlaceholder')
            }
        });

        // Load data dari GitHub (opsional)
        async function loadDataFromGithub() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/hocindo/hocindo.github.io/main/financial_dashboard/equity_data.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                table.clear().rows.add(data).draw();
            } catch (error) {
                console.error('Error loading data from GitHub:', error);
                alert('Gagal memuat data dari GitHub. Menggunakan data statis.');
            }
        }

        // Filter level
        const levelFilter = document.getElementById('levelFilter');
        initialData.forEach(row => {
            const option = document.createElement('option');
            option.value = row.level;
            option.text = `Level ${row.level}`;
            levelFilter.appendChild(option);
        });

        levelFilter.addEventListener('change', function() {
            const value = this.value;
            table.column(0).search(value ? `^${value}$` : '', true, false).draw();
        });

        // Search input
        document.getElementById('searchInput').addEventListener('input', function() {
            table.search(this.value).draw();
        });

        // Export CSV
        document.getElementById('exportCsv').addEventListener('click', function() {
            const data = table.data().toArray();
            const csv = Papa.unparse(data);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'hocindo_equity_map.csv';
            link.click();
        });

        // Export JSON
        document.getElementById('exportJson').addEventListener('click', function() {
            const data = table.data().toArray();
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'hocindo_equity_map.json';
            link.click();
        });

        // Dark mode toggle
        document.getElementById('modeToggle').addEventListener('click', function() {
            document.documentElement.classList.toggle('dark');
            this.innerHTML = document.documentElement.classList.contains('dark') 
                ? '<i class="fas fa-sun"></i>' 
                : '<i class="fas fa-moon"></i>';
        });

        // Inisialisasi Chart.js
        const ctx = document.getElementById('equityChart').getContext('2d');
        const equityChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: initialData.map(row => `Level ${row.level}`),
                datasets: [
                    {
                        label: 'Saldo',
                        data: initialData.map(row => row.saldo),
                        borderColor: '#4CAF50',
                        fill: false
                    },
                    {
                        label: 'Equitas Laba',
                        data: initialData.map(row => row.equitasLaba),
                        borderColor: '#2563eb',
                        fill: false
                    },
                    {
                        label: 'Equitas Rugi',
                        data: initialData.map(row => row.equitasRugi),
                        borderColor: '#dc2626',
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'Equity Growth Trend' }
                },
                scales: {
                    y: { beginAtZero: false, title: { display: true, text: 'Value ($)' } },
                    x: { 
                        title: { display: true, text: 'Level' },
                        ticks: {
                            maxTicksLimit: 20 // Limit x-axis labels to avoid clutter
                        }
                    }
                }
            }
        });

        // Update chart saat tabel di-filter
        table.on('draw', function() {
            const filteredData = table.rows({ filter: 'applied' }).data().toArray();
            equityChart.data.labels = filteredData.map(row => `Level ${row.level}`);
            equityChart.data.datasets[0].data = filteredData.map(row => row.saldo);
            equityChart.data.datasets[1].data = filteredData.map(row => row.equitasLaba);
            equityChart.data.datasets[2].data = filteredData.map(row => row.equitasRugi);
            equityChart.update();
        });

        // Ganti bahasa
        document.getElementById('languageSelect').addEventListener('change', function() {
            i18next.changeLanguage(this.value, function(err, t) {
                updateTranslations();
                table.draw();
            });
        });

        // Load data dari GitHub saat halaman dimuat (opsional)
        // loadDataFromGithub(); // Uncomment if using GitHub data
    </script>
</body>
</html>
